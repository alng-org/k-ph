<!DOCTYPE html>
<html>
<head>
    
    <meta name="viewport" content="width=device-width height=device-height initial-scale=1.0
                               minimum-scale=1.0 maximum-scale=1.0 user-scalable=no"/>
    
    
    <script>
        function style_span(s,clazz){
            let span = document.createElement("span");
            span.className = clazz;
            span.append(s);
            return span;
        }
        function  is_overflow(target){
            return target.scrollWidth > document.body.clientWidth;
        }
        function content(target,str){
            for( let s of str.match(/[A-Z]+|[^A-Z]+/g) ){
                if( /^[A-Z]+$/.test(s) ){
                    target.append(
                        style_span(s,"important")
                    );
                }else{
                    target.append(
                        style_span(s,"normal")
                    );
                }
            }
        }
        function view(str){
            let target = document.getElementById("k-ph");
            target.innerHTML = "";
            content(target,str);
            style();
        }
        function style(){
            let target = document.getElementById("k-ph");
            if(is_overflow(target)){
                target.className = "overflow";
                target.style.setProperty("animation-duration",`${target.innerText.length/2}s`);
            }else{
                target.className = "contain";
            }
        }
        
        function select(ls){
            return ls[
                Math.floor(
                    ls.length * Math.random()
                )
            ];
        }

        function background(position){
            let furl = (t) => `./${position}.${t}`;
            let target = document.body;
            target.style.setProperty(
                "background-image",
                `url("${furl("webp")}")`
            );
            target.style.setProperty(
                "background-position",
                position
            );
            let img = document.getElementById("bg");
            img.src = furl("jpg");
            img.style.setProperty(
                "object-position",
                position
            );
        }
        function switch_bg(){
            let target = document.body;
            let img = document.getElementById("bg");
            target.addEventListener(
                'animationend',
                (e)=>{
                    requestAnimationFrame(
                        ()=>{
                            img.style.visibility="visible";
                            target.style.backgroundImage = 'none';
                            img.className="transfer-in";
                        }
                    );
                },
                {
                    once: true
                }
            );
            target.className="transfer-out";
        }
        function fallback_bg(){
            let img = document.getElementById("bg");
            img.src = img.src.replace(/^(.+)jpg$/,"$1webp");
            //fallback into loaded webp
            img.addEventListener(
                "contextmenu",
                (e)=>alert(
                    "Failed to load original JPG photo; fell back to loaded WebP photo."
                )
            );
        }
        function init(){
            background(
                select(
                    position()
                )
            );
            view(
                select(
                    statement()
                )
            );
        }

    </script>
    <script src="./config.js"></script>
    <style>
        .important{
            animation-name: impo;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
            animation-duration:5s;
            animation-direction: alternate;
            animation-fill-mode: both;
        }
        @keyframes impo{
            from,25%{
                color: crimson;
            }
            75%,to{
                color: peachpuff;
            }
        }
        .normal{
            animation-name: norm;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
            animation-duration:5s;
            animation-direction: alternate;
            animation-fill-mode: both;
        }
        @keyframes norm{
            from,25%{
                color: blueviolet;
            }
            75%,to{
                color: yellow;
            }
        }
        #k-ph{
            position: fixed;
            top: 50%;
            transform-box: view-box;
            font-weight: bolder;
            font-size: 3rem;
            opacity: 0.5;
            color: burlywood;
            user-select: none;
            white-space: pre;
        }
        .contain{
            left: 50%;
            transform: translate(-50%,-50%);
        }
        .overflow{
            animation-name: k_ph;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }
        @keyframes k_ph {
            from{
                left:100%;
                transform: translate(0%,-50%);
            }
            to {
                left:0%;
                transform: translate(-100%,-50%);
            }   
        }
        body{
            margin: 0;
            height: 100dvh;
            width: 100dvw;
            overflow: hidden;
            overscroll-behavior: none;
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        #bg{
            position: fixed;
            
            height: 100dvh;
            width: 100dvw;
            overflow:hidden;
            object-fit:cover;
            visibility:hidden;
        }
        .transfer-out{
            animation-name: tr-out;
            animation-duration: 1.5s;
            animation-timing-function: ease-in;
            animation-fill-mode: forwards;
        }
        @keyframes tr-out{
            from{
                backdrop-filter:blur(0px);
            }
            to{
                backdrop-filter:blur(10px);
            }
        }
        .transfer-in{
            animation-name: tr-in;
            animation-duration: 1.5s;
            animation-timing-function: ease-out;
            animation-fill-mode: forwards;
        }
        @keyframes tr-in{
            from{
                filter:blur(10px);
            }
            to{
                filter:blur(0px);
            }
        }    
    </style>
</head>
<body
class="transfer"
onload="init()";
onresize="style();"
>
    <img id ="bg" onload="switch_bg()" onerror="fallback_bg()">
    <div id = "k-ph">
        Waiting....
    </div>
</body>
</html>





















